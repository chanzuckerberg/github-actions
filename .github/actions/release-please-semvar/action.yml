name: Release please
description: Runs release please and tags unpinned major and minor versions
inputs:
  app_token:
    description: 'App token obtained using create-github-app-token'
    required: true
  include_component_in_tag:
    description: 'If true, add prefix to tags and branches, allowing multiple libraries to be released from the same repository'
    required: false
    default: false
runs:
  using: "composite"
  steps:
    - name: release please
      uses: googleapis/release-please-action@v4
      id: release
      with:
        token: ${{ inputs.app_token }}
        include-component-in-tag: ${{ inputs.include_component_in_tag }}
    - uses: actions/checkout@v4
    - name: tag major and minor versions
      shell: bash
      run: |
        git config user.name czi-github-helper[bot]
        git config user.email 95879977+czi-github-helper[bot]@users.noreply.github.com
        git tag -d v${{ steps.release.outputs.major }} || true
        git tag -d v${{ steps.release.outputs.major }}.${{ steps.release.outputs.minor }} || true
        git push origin :v${{ steps.release.outputs.major }} || true
        git push origin :v${{ steps.release.outputs.major }}.${{ steps.release.outputs.minor }} || true
        git tag -a v${{ steps.release.outputs.major }} -m "Release v${{ steps.release.outputs.major }}"
        git tag -a v${{ steps.release.outputs.major }}.${{ steps.release.outputs.minor }} -m "Release v${{ steps.release.outputs.major }}.${{ steps.release.outputs.minor }}"
        git push origin v${{ steps.release.outputs.major }}
        git push origin v${{ steps.release.outputs.major }}.${{ steps.release.outputs.minor }}
      if: ${{ steps.release.outputs.release_created }}
